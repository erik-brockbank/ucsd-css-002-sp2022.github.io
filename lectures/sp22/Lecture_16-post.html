
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lecture 16 (5/2/2022) &#8212; UCSD CSS 2 - Spring 2022</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.5f77b4aec8189eecf79907ce328c390d.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lecture 17 (5/4/2022)" href="Lecture_17-post.html" />
    <link rel="prev" title="Lecture 15 (4/29/2022)" href="Lecture_15-post.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">UCSD CSS 2 - Spring 2022</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../index.html">
   Welcome to CSS 2
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Course (CSS 2 Spring 2022)
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../course/syllabus.html">
   Syllabus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../course/expectations.html">
   Expectations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../course/datahub.html">
   Datahub assignments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../course/debugging.html">
   Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../course/resources.html">
   Extracurricular Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../course/final.html">
   Final Project
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lectures - download before class
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Week1_Overview.html">
   Week 1
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_1.html">
     Lecture 1 (3/28/2022)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_2-pre.html">
     Lecture 2 (3/30/22)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_3-pre.html">
     Lecture 3 (4/1/22)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Week2_Overview.html">
   Week 2
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_4-pre.html">
     Lecture 4 (4/4/22)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_5-pre.html">
     Lecture 5 (4/6/22)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_6-pre.html">
     Lecture 6 (4/8/22)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Week3_Overview.html">
   Week 3
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_7-pre.html">
     Lecture 7 (guest) - Introduction to Data Visualization in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_8.html">
     Lecture 8 (4/13/2022)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_9-pre.html">
     Lecture 9 (guest) - Data Visualization with Seaborn
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Week4_Overview.html">
   Week 4
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_10-pre.html">
     Lecture 10 (4/18/22)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_11-pre.html">
     Lecture 11 (4/20/2022)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_12-pre.html">
     Lecture 12 (4/22/2022)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Week5_Overview.html">
   Week 5
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_13-pre.html">
     Lecture 13 (4/25/22)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_14-pre.html">
     Lecture 14 (4/27/2022)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_15-pre.html">
     Lecture 15 (4/29/2022)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Week6_Overview.html">
   Week 6
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_16-pre.html">
     Lecture 16 (5/2/2022)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_17-pre.html">
     Lecture 17 (5/4/2022)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_18-pre.html">
     Lecture 18 (5/6/2022)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Week7_Overview.html">
   Week 7
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_19-pre.html">
     Lecture 19 (5/9/2022)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_20-pre.html">
     Lecture 20 (5/11/2022)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_21-pre.html">
     Lecture 21 (5/13/2022)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Week8_Overview.html">
   Week 8
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_22-pre.html">
     Lecture 22 (5/16/2022)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_23-pre.html">
     Lecture 23 (5/18/2022)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_24-pre.html">
     Lecture 24 (5/20/2022)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Week9_Overview.html">
   Week 9
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_25-pre.html">
     Lecture 25 (5/23/2022)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_26-pre.html">
     Lecture 26 (5/25/2022)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_27-pre.html">
     Lecture 27 (5/27/2022)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Week10_Overview.html">
   Week 10
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Lecture_28-pre.html">
     Lecture 28 (6/3/2022)
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lecture code - available after class
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_2-post.html">
   Lecture 2 (3/30/22)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_3-post.html">
   Lecture 3 (4/1/22)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_4-post.html">
   Lecture 4 (4/4/22)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_5-post.html">
   Lecture 5 (4/6/22)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_6-post.html">
   Lecture 6 (4/8/22)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_7-post.html">
   Lecture 7 (guest) - Introduction to Data Visualization in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_9-post.html">
   Lecture 9 (guest) Data Visualization with Seaborn
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_10-post.html">
   Lecture 10 (4/18/22)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_11-post.html">
   Lecture 11 (4/20/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_12-post.html">
   Lecture 12 (4/22/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_13-post.html">
   Lecture 13 (4/25/22)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_14-post.html">
   Lecture 14 (4/27/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_15-post.html">
   Lecture 15 (4/29/2022)
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Lecture 16 (5/2/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_17-post.html">
   Lecture 17 (5/4/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_18-post.html">
   Lecture 18 (5/6/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_19-post.html">
   Lecture 19 (5/9/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_20-post.html">
   Lecture 20 (5/11/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_21-post.html">
   Lecture 21 (5/13/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_22-post.html">
   Lecture 22 (5/16/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_23-post.html">
   Lecture 23 (5/18/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_24-post.html">
   Lecture 24 (5/20/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_25-post.html">
   Lecture 25 (5/23/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_26-post.html">
   Lecture 26 (5/25/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_27-post.html">
   Lecture 27 (5/27/2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Lecture_28-post.html">
   Lecture 28 (6/3/2022)
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/lectures/sp22/Lecture_16-post.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/erik-brockbank/ucsd-css-002-sp2022.github.io"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/erik-brockbank/ucsd-css-002-sp2022.github.io/issues/new?title=Issue%20on%20page%20%2Flectures/sp22/Lecture_16-post.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/erik-brockbank/ucsd-css-002-sp2022.github.io/master?urlpath=tree/lectures/sp22/Lecture_16-post.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Lecture 16 (5/2/2022)
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multiple-regression">
   Multiple Regression
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#big-idea-multiple-predictors-for-y">
     Big idea: multiple predictors for
     <span class="math notranslate nohighlight">
      \(y\)
     </span>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-predicting-life-expectancy">
     Example: predicting life expectancy
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multiple-regression-overview">
       Multiple regression: overview
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-regression-in-python">
     Multiple regression in python
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regression-wrap-up">
   Regression: wrap-up
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overfitting">
   Overfitting
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-is-it">
     What is it?
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     Example
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overfitting-summary">
     Overfitting summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cross-validation-avoiding-overfitting">
   Cross-validation: avoiding overfitting
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cross-validation-summary">
   Cross-Validation Summary
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="lecture-16-5-2-2022">
<h1>Lecture 16 (5/2/2022)<a class="headerlink" href="#lecture-16-5-2-2022" title="Permalink to this headline">¶</a></h1>
<p><strong>Announcements</strong></p>
<p><em>Last time we covered:</em></p>
<ul class="simple">
<li><p>Linear regression</p>
<ul>
<li><p>Simple linear regression</p></li>
<li><p>Evaluating regression</p></li>
<li><p>Polynomial and multiple regression</p></li>
</ul>
</li>
</ul>
<p><strong>Today’s agenda:</strong></p>
<ul class="simple">
<li><p>Multiple regression continued</p></li>
<li><p>Overfitting</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="multiple-regression">
<h1>Multiple Regression<a class="headerlink" href="#multiple-regression" title="Permalink to this headline">¶</a></h1>
<div class="section" id="big-idea-multiple-predictors-for-y">
<h2>Big idea: multiple predictors for <span class="math notranslate nohighlight">\(y\)</span><a class="headerlink" href="#big-idea-multiple-predictors-for-y" title="Permalink to this headline">¶</a></h2>
<p>In real-world scenarios, it’s common to explore the relationship between <em>multiple</em> predictor variables that all jointly impact the dependent variable.</p>
<p>For this, we need <strong>multiple regression</strong>.</p>
<p>Though the guiding principles are similar to <em>simple regression</em>, things can get much more complicated in multiple dimensions. Here, we’ll provide enough of an overview for you to be able to use multiple regression as part of your modeling toolbox.</p>
</div>
<div class="section" id="example-predicting-life-expectancy">
<h2>Example: predicting life expectancy<a class="headerlink" href="#example-predicting-life-expectancy" title="Permalink to this headline">¶</a></h2>
<p>Let’s start with a familiar example.</p>
<p>In Problem Set 3 and elsewhere, we’ve looked at the <em>gapminder</em> dataset, which explores the relationship between GDP, population, and life expectancy at the national level and over time.</p>
<p>Here, we’ll just look at these variables for the most recent year (2007).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/UCSD-CSS-002/ucsd-css-002.github.io/master/datasets/gapminder.csv&quot;</span><span class="p">)</span>

<span class="c1"># Let&#39;s keep just some of the variables (note for pset!)</span>
<span class="c1"># NOTE: we&#39;re also just restricting ourselves to 2007</span>
<span class="n">gap_subset</span> <span class="o">=</span> <span class="n">gap</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gap</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2007</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;lifeExp&#39;</span><span class="p">,</span> <span class="s1">&#39;pop&#39;</span><span class="p">,</span> <span class="s1">&#39;gdpPercap&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Add log transformed population and income</span>
<span class="n">gap_subset</span><span class="p">[</span><span class="s1">&#39;logPop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">gap_subset</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">])</span>
<span class="n">gap_subset</span><span class="p">[</span><span class="s1">&#39;logGdpPercap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">gap_subset</span><span class="p">[</span><span class="s1">&#39;gdpPercap&#39;</span><span class="p">])</span>
<span class="n">gap_subset</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>lifeExp</th>
      <th>pop</th>
      <th>gdpPercap</th>
      <th>logPop</th>
      <th>logGdpPercap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>2007</td>
      <td>43.828</td>
      <td>31889923</td>
      <td>974.580338</td>
      <td>7.503653</td>
      <td>2.988818</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Albania</td>
      <td>2007</td>
      <td>76.423</td>
      <td>3600523</td>
      <td>5937.029526</td>
      <td>6.556366</td>
      <td>3.773569</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Algeria</td>
      <td>2007</td>
      <td>72.301</td>
      <td>33333216</td>
      <td>6223.367465</td>
      <td>7.522877</td>
      <td>3.794025</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Angola</td>
      <td>2007</td>
      <td>42.731</td>
      <td>12420476</td>
      <td>4797.231267</td>
      <td>7.094138</td>
      <td>3.680991</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Argentina</td>
      <td>2007</td>
      <td>75.320</td>
      <td>40301927</td>
      <td>12779.379640</td>
      <td>7.605326</td>
      <td>4.106510</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>137</th>
      <td>Vietnam</td>
      <td>2007</td>
      <td>74.249</td>
      <td>85262356</td>
      <td>2441.576404</td>
      <td>7.930757</td>
      <td>3.387670</td>
    </tr>
    <tr>
      <th>138</th>
      <td>West Bank and Gaza</td>
      <td>2007</td>
      <td>73.422</td>
      <td>4018332</td>
      <td>3025.349798</td>
      <td>6.604046</td>
      <td>3.480776</td>
    </tr>
    <tr>
      <th>139</th>
      <td>Yemen, Rep.</td>
      <td>2007</td>
      <td>62.698</td>
      <td>22211743</td>
      <td>2280.769906</td>
      <td>7.346583</td>
      <td>3.358081</td>
    </tr>
    <tr>
      <th>140</th>
      <td>Zambia</td>
      <td>2007</td>
      <td>42.384</td>
      <td>11746035</td>
      <td>1271.211593</td>
      <td>7.069891</td>
      <td>3.104218</td>
    </tr>
    <tr>
      <th>141</th>
      <td>Zimbabwe</td>
      <td>2007</td>
      <td>43.487</td>
      <td>12311143</td>
      <td>469.709298</td>
      <td>7.090298</td>
      <td>2.671829</td>
    </tr>
  </tbody>
</table>
<p>142 rows × 7 columns</p>
</div></div></div>
</div>
<p>In Problem Set 3, you generated a graph that explored the relationship between income (GDP per-capita on <span class="math notranslate nohighlight">\(x\)</span>) and life expectancy (in years on <span class="math notranslate nohighlight">\(y\)</span>), alongside two additional predictors: region (color) and population (size).</p>
<p><img alt="gap" src="../../_images/gapminder.png" /></p>
<p>Here, we want to know formally what the relationship is between the three continuous variables (income, life expectancy, and population). In other words, <strong>can we predict life expectancy using both income <em>and</em> population better than we could only using one of those variables?</strong></p>
<p>Let’s start by just examining each of the predictors in isolation to see if this is a plausible hypothesis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">gap_subset</span><span class="p">,</span> 
                    <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;logGdpPercap&quot;</span><span class="p">,</span> <span class="c1"># x1 </span>
                    <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;lifeExp&quot;</span>
                   <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Life expectancy as a function of income&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Income (log GDP / capita)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Life expectancy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">gap_subset</span><span class="p">,</span> 
                    <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;logPop&quot;</span><span class="p">,</span> <span class="c1"># x2 </span>
                    <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;lifeExp&quot;</span>
                   <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Life expectancy as a function of population&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Population (log)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Life expectancy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Lecture_16-post_8_0.png" src="../../_images/Lecture_16-post_8_0.png" />
<img alt="../../_images/Lecture_16-post_8_1.png" src="../../_images/Lecture_16-post_8_1.png" />
</div>
</div>
<p>One of these variables has a strong positive relationship. The other one seems a bit less clear.</p>
<p>How can we think about exploring the role that both of them play together in predicting life expectancy?</p>
<div class="section" id="multiple-regression-overview">
<h3>Multiple regression: overview<a class="headerlink" href="#multiple-regression-overview" title="Permalink to this headline">¶</a></h3>
<p>Multiple regression is like linear regression except that we assume our dependent variable <span class="math notranslate nohighlight">\(y_i\)</span> is <em>jointly</em> predicted by multiple independent variables:</p>
<p><span class="math notranslate nohighlight">\(x_1\)</span>, <span class="math notranslate nohighlight">\(x_2\)</span>, …, <span class="math notranslate nohighlight">\(x_n\)</span>.</p>
<p>Simple linear regression generates a <em>predicted</em> <span class="math notranslate nohighlight">\(\hat{y}_i\)</span> from <span class="math notranslate nohighlight">\(x_i\)</span>:</p>
<p><span class="math notranslate nohighlight">\(\hat{y}_i = \beta_0 + \beta_1 x_i + \epsilon_i\)</span></p>
<p>With multiple regression, we now extend this model to include multiple predictors for our data (<span class="math notranslate nohighlight">\(x_{1i}\)</span>, <span class="math notranslate nohighlight">\(x_{2i}\)</span>, …, <span class="math notranslate nohighlight">\(x_{ni}\)</span>):</p>
<p><span class="math notranslate nohighlight">\(\hat{y}_i = \beta_0 + \beta_1 x_{1i} + \beta_2 x_{2i} + \ ... \ + \beta_n x_{ni} + \epsilon_i \)</span></p>
<p>In most cases, multiple regression once again uses the same <em>Ordinary Least Squares</em> (OLS) parameter estimation as simple regression. However, interpreting the parameter estimates is a little less straightforward.</p>
<p><em>How would we interpret <span class="math notranslate nohighlight">\(\beta_0 = 1\)</span>, <span class="math notranslate nohighlight">\(\beta_1 = 2\)</span>, <span class="math notranslate nohighlight">\(\beta_2 = 3\)</span>?</em></p>
<p>(Think of a simple example. What variables would you want to use to predict somebody’s height <em>as accurately as possible</em>? Now imagine each of those variables is one of your <span class="math notranslate nohighlight">\(x_{ji}\)</span> variables.)</p>
</div>
</div>
<div class="section" id="multiple-regression-in-python">
<h2>Multiple regression in python<a class="headerlink" href="#multiple-regression-in-python" title="Permalink to this headline">¶</a></h2>
<p>The scikit-learn <code class="docutils literal notranslate"><span class="pre">LinearRegression</span></code> class is very easy to extend to multiple regression!</p>
<p>We’ll also demonstrate the <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> approach below for more robust statistical analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># scikit learn approach</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gap_subset</span><span class="p">[[</span><span class="s1">&#39;logGdpPercap&#39;</span><span class="p">,</span> <span class="s1">&#39;logPop&#39;</span><span class="p">]])</span> <span class="c1"># Note: this double bracket syntax is important!</span>
<span class="n">x_vals</span> <span class="o">=</span> <span class="n">x_vals</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gap_subset</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">x_vals</span>

<span class="n">y_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gap_subset</span><span class="p">[</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">])</span>
<span class="n">y_vals</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x_vals</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_vals</span><span class="p">)</span>

<span class="n">mod</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">mod</span><span class="o">.</span><span class="n">coef_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([16.6811828 ,  1.86827925])
</pre></div>
</div>
</div>
</div>
<p>What do the coefficient estimates above suggest?</p>
<p>How should we interpret them?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># R^2 for our regression</span>
<span class="n">mod</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x_vals</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_vals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6649393884784984
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># What if we don&#39;t include the population predictor?</span>
<span class="n">x_single</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gap_subset</span><span class="p">[</span><span class="s1">&#39;logGdpPercap&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gap_subset</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">x_single</span>

<span class="n">mod_simple</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x_single</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_vals</span><span class="p">)</span>
<span class="n">mod_simple</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x_single</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_vals</span><span class="p">)</span>

<span class="c1"># Doesn&#39;t seem like population helps much...</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6544490472926064
</pre></div>
</div>
</div>
</div>
<p>The statsmodels approach gives us a bit more insight here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># statsmodels approach</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="n">multiple_reg</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;lifeExp ~ logGdpPercap + logPop&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">gap_subset</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># View the results</span>
<span class="n">multiple_reg</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

<span class="c1"># Our population variable does have a significant positive slope, </span>
<span class="c1"># but it&#39;s pretty small and the effect may be driven by outliers.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>         <td>lifeExp</td>     <th>  R-squared:         </th> <td>   0.665</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.660</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   137.9</td>
</tr>
<tr>
  <th>Date:</th>             <td>Tue, 14 Jun 2022</td> <th>  Prob (F-statistic):</th> <td>9.91e-34</td>
</tr>
<tr>
  <th>Time:</th>                 <td>18:22:49</td>     <th>  Log-Likelihood:    </th> <td> -477.07</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>   142</td>      <th>  AIC:               </th> <td>   960.1</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   139</td>      <th>  BIC:               </th> <td>   969.0</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     2</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
        <td></td>          <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>    <td>   -8.6161</td> <td>    7.538</td> <td>   -1.143</td> <td> 0.255</td> <td>  -23.520</td> <td>    6.288</td>
</tr>
<tr>
  <th>logGdpPercap</th> <td>   16.6812</td> <td>    1.008</td> <td>   16.555</td> <td> 0.000</td> <td>   14.689</td> <td>   18.673</td>
</tr>
<tr>
  <th>logPop</th>       <td>    1.8683</td> <td>    0.896</td> <td>    2.086</td> <td> 0.039</td> <td>    0.098</td> <td>    3.639</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>34.155</td> <th>  Durbin-Watson:     </th> <td>   2.170</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td>  54.987</td>
</tr>
<tr>
  <th>Skew:</th>          <td>-1.183</td> <th>  Prob(JB):          </th> <td>1.15e-12</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 4.923</td> <th>  Cond. No.          </th> <td>    104.</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
</div>
</div>
<div class="section" id="regression-wrap-up">
<h1>Regression: wrap-up<a class="headerlink" href="#regression-wrap-up" title="Permalink to this headline">¶</a></h1>
<p>Regression is one of the most powerful tools in our data science / analysis toolkit.</p>
<p>However, it’s important to be familiar with the <em>limitations</em> in regression as well.</p>
<p>One class of these limitations is when <strong>the data violate the assumptions of linear regression</strong>. We’re <em>not</em> going to get into these issues in this class, but it’s good to be aware that not all data (even data that looks linear!) can be accurately described by linear regression. There are a number of tricks for diagnosing this, such as plotting your residuals (we may explore this on the problem set as a way to cover some of this material).</p>
<p>However, an important limitation that we <em>will</em> discuss now is when <strong>regression overfits the data</strong>. Avoiding overfitting is something that arises in just about any modeling context. It’s easiest to illustrate with regression, but the things we discuss here will be relevant throughout the remainder of the quarter.</p>
</div>
<hr class="docutils" />
<div class="section" id="overfitting">
<h1>Overfitting<a class="headerlink" href="#overfitting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-it">
<h2>What is it?<a class="headerlink" href="#what-is-it" title="Permalink to this headline">¶</a></h2>
<p>The basic principle behind overfitting is that when your modeling approach is sufficiently <em>unconstrained</em>, you can fit patterns in your data that <em>do not generalize</em>.</p>
<p>What does it mean for a model to be unconstrained? What does it mean for the model not to generalize?</p>
<p>…</p>
<p><em>How does this happen?</em></p>
<p>There are lots of ways this can arise (and what it looks like differs across modeling techniques).</p>
<p>Let’s look at a canonical example just to get an intuition. For models that we learn about throughout the rest of the quarter, it’s a useful exercise to think about what overfitting might look like.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Let’s return to our <code class="docutils literal notranslate"><span class="pre">gapminder</span></code> dataset and the task of predicting <em>life expectancy</em> (<span class="math notranslate nohighlight">\(y\)</span>) based on <em>income</em> (<span class="math notranslate nohighlight">\(x\)</span>).</p>
<p>What kind of relationship do we think these variables have in the data below?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gap_subset</span>


<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">gap_subset</span><span class="p">,</span> 
                    <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;logGdpPercap&quot;</span><span class="p">,</span> <span class="c1"># x1 </span>
                    <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;lifeExp&quot;</span><span class="p">,</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
                   <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Life expectancy as a function of income&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Income (log GDP / capita)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Life expectancy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Lecture_16-post_22_0.png" src="../../_images/Lecture_16-post_22_0.png" />
</div>
</div>
<p>Let’s start with a <strong>simple linear regression</strong>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Estimate the model</span>
<span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gap_subset</span><span class="p">[</span><span class="s1">&#39;logGdpPercap&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gap_subset</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gap_subset</span><span class="p">[</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">])</span>
<span class="n">deg1_fits</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x_vals</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_vals</span><span class="p">)</span>

<span class="c1"># Add predictions for this model to our dataframe</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">gap_subset</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="s2">&quot;logGdpPercap&quot;</span><span class="p">,</span> <span class="s2">&quot;lifeExp&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">simple_preds</span> <span class="o">=</span> <span class="n">deg1_fits</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x_vals</span><span class="p">)</span>


<span class="n">preds</span><span class="p">[</span><span class="s1">&#39;deg1_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_preds</span>

<span class="n">preds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>logGdpPercap</th>
      <th>lifeExp</th>
      <th>deg1_pred</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.988818</td>
      <td>43.828</td>
      <td>54.519342</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.773569</td>
      <td>76.423</td>
      <td>67.534497</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.794025</td>
      <td>72.301</td>
      <td>67.873765</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.680991</td>
      <td>42.731</td>
      <td>65.999076</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.106510</td>
      <td>75.320</td>
      <td>73.056337</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>137</th>
      <td>3.387670</td>
      <td>74.249</td>
      <td>61.134339</td>
    </tr>
    <tr>
      <th>138</th>
      <td>3.480776</td>
      <td>73.422</td>
      <td>62.678496</td>
    </tr>
    <tr>
      <th>139</th>
      <td>3.358081</td>
      <td>62.698</td>
      <td>60.643606</td>
    </tr>
    <tr>
      <th>140</th>
      <td>3.104218</td>
      <td>42.384</td>
      <td>56.433262</td>
    </tr>
    <tr>
      <th>141</th>
      <td>2.671829</td>
      <td>43.487</td>
      <td>49.262068</td>
    </tr>
  </tbody>
</table>
<p>142 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the fit</span>

<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">preds</span><span class="p">,</span> 
                <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;logGdpPercap&quot;</span><span class="p">,</span>
                <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;lifeExp&quot;</span><span class="p">,</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
               <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">preds</span><span class="p">,</span>
             <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;logGdpPercap&quot;</span><span class="p">,</span>
             <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;deg1_pred&quot;</span>
            <span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Life expectancy as a function of income&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Income (log GDP / capita)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Life expectancy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Lecture_16-post_25_0.png" src="../../_images/Lecture_16-post_25_0.png" />
</div>
</div>
<p>How did we do? Maybe this data is <em>quadratic</em> or <em>cubic</em>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>

<span class="c1"># Fit degree 2 polynomial regression</span>
<span class="n">poly2</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">include_bias</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">x2_features</span> <span class="o">=</span> <span class="n">poly2</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
<span class="n">mod2</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x2_features</span><span class="p">,</span> <span class="n">y_vals</span><span class="p">)</span>

<span class="c1"># Fit degree 3 polynomial regression</span>
<span class="n">poly3</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">include_bias</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">x3_features</span> <span class="o">=</span> <span class="n">poly3</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
<span class="n">mod3</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x3_features</span><span class="p">,</span> <span class="n">y_vals</span><span class="p">)</span>

<span class="c1"># Add these to our predictions</span>
<span class="n">preds</span><span class="p">[</span><span class="s1">&#39;deg2_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x2_features</span><span class="p">)</span>
<span class="n">preds</span><span class="p">[</span><span class="s1">&#39;deg3_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x3_features</span><span class="p">)</span>
<span class="n">preds</span>

<span class="c1"># How do these predictions look at first glance? More accurate?</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>logGdpPercap</th>
      <th>lifeExp</th>
      <th>deg1_pred</th>
      <th>deg2_pred</th>
      <th>deg3_pred</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.988818</td>
      <td>43.828</td>
      <td>54.519342</td>
      <td>54.128139</td>
      <td>54.071604</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.773569</td>
      <td>76.423</td>
      <td>67.534497</td>
      <td>68.392417</td>
      <td>68.422855</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.794025</td>
      <td>72.301</td>
      <td>67.873765</td>
      <td>68.722745</td>
      <td>68.758756</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.680991</td>
      <td>42.731</td>
      <td>65.999076</td>
      <td>66.871091</td>
      <td>66.875117</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.106510</td>
      <td>75.320</td>
      <td>73.056337</td>
      <td>73.506613</td>
      <td>73.595809</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>137</th>
      <td>3.387670</td>
      <td>74.249</td>
      <td>61.134339</td>
      <td>61.765814</td>
      <td>61.694179</td>
    </tr>
    <tr>
      <th>138</th>
      <td>3.480776</td>
      <td>73.422</td>
      <td>62.678496</td>
      <td>63.433290</td>
      <td>63.381871</td>
    </tr>
    <tr>
      <th>139</th>
      <td>3.358081</td>
      <td>62.698</td>
      <td>60.643606</td>
      <td>61.226743</td>
      <td>61.149956</td>
    </tr>
    <tr>
      <th>140</th>
      <td>3.104218</td>
      <td>42.384</td>
      <td>56.433262</td>
      <td>56.420367</td>
      <td>56.336913</td>
    </tr>
    <tr>
      <th>141</th>
      <td>2.671829</td>
      <td>43.487</td>
      <td>49.262068</td>
      <td>47.486363</td>
      <td>47.642830</td>
    </tr>
  </tbody>
</table>
<p>142 rows × 5 columns</p>
</div></div></div>
</div>
<p>Let’s plot these lines and see how they look:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, let&#39;s make our data tidy for easier plotting</span>
<span class="n">preds_long</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
    <span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;logGdpPercap&quot;</span><span class="p">,</span> <span class="s2">&quot;lifeExp&quot;</span><span class="p">],</span>
    <span class="n">var_name</span> <span class="o">=</span> <span class="s2">&quot;degree&quot;</span><span class="p">,</span>
    <span class="n">value_name</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span>
<span class="p">)</span>

<span class="n">preds_long</span>

<span class="c1"># Now, let&#39;s take a look</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">preds_long</span><span class="p">,</span> 
                <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;logGdpPercap&quot;</span><span class="p">,</span>
                <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;lifeExp&quot;</span><span class="p">,</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.1</span>
               <span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">preds_long</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;logGdpPercap&quot;</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
    <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;degree&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;logGdpPercap&#39;, ylabel=&#39;lifeExp&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/Lecture_16-post_29_1.png" src="../../_images/Lecture_16-post_29_1.png" />
</div>
</div>
<p>These lines look pretty similar. Do we see any change in <span class="math notranslate nohighlight">\(R^2\)</span> values for these models?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get R^2 for each model</span>
<span class="n">mod1_rsq</span> <span class="o">=</span> <span class="n">deg1_fits</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x_vals</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_vals</span><span class="p">)</span>
<span class="n">mod2_rsq</span> <span class="o">=</span> <span class="n">mod2</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x2_features</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_vals</span><span class="p">)</span>
<span class="n">mod3_rsq</span> <span class="o">=</span> <span class="n">mod3</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x3_features</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_vals</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Degree 1 R^2: </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">Degree 2 R^2: </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">Degree 3 R^2: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">mod1_rsq</span><span class="p">,</span> <span class="n">mod2_rsq</span><span class="p">,</span> <span class="n">mod3_rsq</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Degree 1 R^2: 0.6544490472926064 
Degree 2 R^2: 0.6588616234359694 
Degree 3 R^2: 0.6589091468875565
</pre></div>
</div>
</div>
</div>
<p><em>What does this tell us?</em></p>
<p>Probably don’t need 2nd or 3rd degree polynomials for this relationship.</p>
<p><em>What happens if we try to fit a much higher-order polynomial function to this data?</em> Similar line or something else?</p>
<p>???</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit degree 10 polynomial regression</span>
<span class="n">poly10</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">include_bias</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">x10_features</span> <span class="o">=</span> <span class="n">poly10</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
<span class="n">mod10</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x10_features</span><span class="p">,</span> <span class="n">y_vals</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s compare this one to our <span class="math notranslate nohighlight">\(R^2\)</span> values above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate R^2 for our degree 10 polynomial</span>
<span class="n">mod10_rsq</span> <span class="o">=</span> <span class="n">mod10</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x10_features</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_vals</span><span class="p">)</span>
<span class="n">mod10_rsq</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6708222009621823
</pre></div>
</div>
</div>
</div>
<p>Improvement! Let’s keep going!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit degree 25 polynomial regression</span>
<span class="n">poly25</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">include_bias</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">x25_features</span> <span class="o">=</span> <span class="n">poly25</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
<span class="n">mod25</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x25_features</span><span class="p">,</span> <span class="n">y_vals</span><span class="p">)</span>

<span class="c1"># Check R^2</span>
<span class="n">mod25_rsq</span> <span class="o">=</span> <span class="n">mod25</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x25_features</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_vals</span><span class="p">)</span>
<span class="n">mod25_rsq</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6716693321510845
</pre></div>
</div>
</div>
</div>
<p>Okay maybe things are slowing down…</p>
<p>Let’s plot our functions and see how they look.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to predictions dataframe and re-format</span>
<span class="n">preds</span><span class="p">[</span><span class="s1">&#39;deg10_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod10</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x10_features</span><span class="p">)</span>
<span class="n">preds</span><span class="p">[</span><span class="s1">&#39;deg25_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod25</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">x25_features</span><span class="p">)</span>

<span class="n">preds_long</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
    <span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;logGdpPercap&quot;</span><span class="p">,</span> <span class="s2">&quot;lifeExp&quot;</span><span class="p">],</span>
    <span class="n">var_name</span> <span class="o">=</span> <span class="s2">&quot;degree&quot;</span><span class="p">,</span>
    <span class="n">value_name</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span>
<span class="p">)</span>

<span class="n">preds_long</span>

<span class="c1"># Now, let&#39;s take a look</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">preds_long</span><span class="p">,</span> 
                <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;logGdpPercap&quot;</span><span class="p">,</span>
                <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;lifeExp&quot;</span><span class="p">,</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.1</span>
               <span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">preds_long</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;logGdpPercap&quot;</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
    <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;degree&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;logGdpPercap&#39;, ylabel=&#39;lifeExp&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/Lecture_16-post_39_1.png" src="../../_images/Lecture_16-post_39_1.png" />
</div>
</div>
<p>Hmmm….</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">preds</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;logGdpPercap&quot;</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;deg10_pred&quot;</span><span class="p">,</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Income&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Predicted life expectancy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">preds</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;logGdpPercap&quot;</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;deg25_pred&quot;</span><span class="p">,</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Income&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Predicted life expectancy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Lecture_16-post_41_0.png" src="../../_images/Lecture_16-post_41_0.png" />
<img alt="../../_images/Lecture_16-post_41_1.png" src="../../_images/Lecture_16-post_41_1.png" />
</div>
</div>
<p>This doesn’t seem like it’s capturing the underlying process that generated our data…</p>
<p><img alt="spaghetti" src="../../_images/spaghetti.jpeg" /></p>
<p>Aside: overfitting is easiest to demonstrate with polynomial regression because it makes Least Squares Spaghetti. However, this problem can arise in almost any modeling context. Think about what this might look like with <em>multiple regression</em>.</p>
</div>
<div class="section" id="overfitting-summary">
<h2>Overfitting summary<a class="headerlink" href="#overfitting-summary" title="Permalink to this headline">¶</a></h2>
<p>The high-degree polynomials above are <strong>unconstrained</strong>, leading them to fit our data <em>too</em> well.</p>
<p>This creates worries that they won’t <strong>generalize</strong>.</p>
<p><em>But how do we test this?</em></p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="cross-validation-avoiding-overfitting">
<h1>Cross-validation: avoiding overfitting<a class="headerlink" href="#cross-validation-avoiding-overfitting" title="Permalink to this headline">¶</a></h1>
<p>There are many different techniques for <em>cross-validation</em>, one of which we discussed on Friday.</p>
<p>However, at their heart, all of them involve the same underlying principle: <em>estimate your model parameters with only a subset (or repeated subsets) of your data, then evaluate your model on the remaining data to ensure generalizability</em>.</p>
<p>This technique allows you to ensure that your model is a good fit, or do <em>model comparison</em> to choose among different candidate models (such as our polynomial models above).</p>
<p>Rather than go through all of the different ways of doing this, I’ll walk through a few of the more well known ones. This will give you a feel for how cross-validation works.</p>
<ol class="simple">
<li><p><strong><em>Holdout</em> cross-validation</strong>: this is the technique we reviewed on Friday</p>
<ul class="simple">
<li><p>Split data into <em>training</em> and <em>test</em> data (e.g. 75-25 split)</p></li>
<li><p>Train model on <em>training data only</em></p></li>
<li><p>Evaluate model on <em>test data</em></p></li>
</ul>
</li>
<li><p><strong><em>k-fold</em> cross-validation</strong>: This is a more robust version of holdout cross-validation</p>
<ul class="simple">
<li><p>Split data into <em>k</em> equal sized buckets (randomly!)</p></li>
<li><p>Choose one of the buckets to be <em>test</em> data and assign the rest to be <em>training</em> data</p></li>
<li><p>Perform holdout cross-validation with this data</p></li>
<li><p>Then, repeat the above <em>for each of the other buckets</em> and average your test results (e.g., MSE) over the multiple runs</p></li>
</ul>
</li>
<li><p><strong><em>Monte-carlo</em> cross-validation</strong> (repeated random subsampling): Similar to k-fold, but <em>random</em></p>
<ul class="simple">
<li><p>Split the data into training and test data randomly</p></li>
<li><p>Evaluate model on test data</p></li>
<li><p>Repeat this process many times</p></li>
</ul>
</li>
<li><p><strong>Exhaustive cross-validation</strong> (various methods): The most common of these are <em>leave-one-out</em> or <em>leave-p-out</em> cross-validation</p>
<ul class="simple">
<li><p>For every individual value in the data or set of <span class="math notranslate nohighlight">\(p\)</span> values, train the model on all remaining data then evalute the model using this individual or set of <span class="math notranslate nohighlight">\(p\)</span> values</p></li>
<li><p>Note: this is <em>exhaustive</em> because every data point or set of <span class="math notranslate nohighlight">\(p\)</span> data points is used in the test set, but is often computationally intractable!</p></li>
</ul>
</li>
<li><p><strong>Other</strong> methods: specific to particular types of data (e.g., time series data, classification data)</p></li>
</ol>
<p>For more info on this, you can check out <a class="reference external" href="https://towardsdatascience.com/understanding-8-types-of-cross-validation-80c935a4976d">this</a> blog, or the wikipedia <a class="reference external" href="https://en.wikipedia.org/wiki/Cross-validation_(statistics)">page</a> devoted to this topic, or many others like it online!</p>
</div>
<div class="section" id="cross-validation-summary">
<h1>Cross-Validation Summary<a class="headerlink" href="#cross-validation-summary" title="Permalink to this headline">¶</a></h1>
<p>The techniques above are used with many if not all of the modeling techniques we’ll discuss this quarter.</p>
<p>From here on out, you should <strong>assume that some form of cross-validation is a <em>required</em> component of any model fitting process</strong>, much like looking at your data, cleaning it, and other core aspects of analysis.</p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./lectures/sp22"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="Lecture_15-post.html" title="previous page">Lecture 15 (4/29/2022)</a>
    <a class='right-next' id="next-link" href="Lecture_17-post.html" title="next page">Lecture 17 (5/4/2022)</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Erik Brockbank<br/>
        
            &copy; Copyright 2022.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>